<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:b="http://bootsfaces.net/ui">

    <ui:composition template="/template.xhtml">
        
        <ui:define name="title">
            <h:outputText value="#{bundle.ViewpacienteTitle}"></h:outputText>
        </ui:define> 

        <ui:define name="body">
            <h:form>
            <p:breadCrumb>
                <p:menuitem value="Categories" url="/faces/home.xhtml" />
                <p:menuitem value="Usuarios"/>
                <p:menuitem value="Búsqueda por RUN" url="/faces/paciente/Buscar.xhtml" />
                <p:menuitem value="#{pacienteController.selected.RUN}-#{pacienteController.selected.DV}" rendered="#{pacienteController.selected != null}" url="/faces/paciente/View.xhtml"/>
            </p:breadCrumb>
            </h:form>
            <br />
            <b:panel id="pacienteViewDlg" title="#{bundle.ViewpacienteTitle}" rendered="#{pacienteController.selected.id !=null}">
            <h:form id="pacienteViewForm">
                <h:panelGroup id="display">
                    <p:panelGrid columns="4" style="width:100%;" rendered="#{pacienteController.selected != null}">
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_RUN}" for="RUN" />
                        <h:outputText id="RUN" value="#{pacienteController.selected.RUN}-#{pacienteController.selected.DV}"/>
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_nombres}" for="nombres" />
                        <h:outputText id="nombres" value="#{pacienteController.selected.nombres}" title="#{bundle.ViewpacienteTitle_nombres}"/>
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_primer_apellido}" for="primer_apellido" />
                        <h:outputText id="primer_apellido" value="#{pacienteController.selected.primer_apellido}" title="#{bundle.ViewpacienteTitle_primer_apellido}"/>
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_segundo_apellido}" for="segundo_apellido" />
                        <h:outputText id="segundo_apellido" value="#{pacienteController.selected.segundo_apellido}" title="#{bundle.ViewpacienteTitle_segundo_apellido}"/>                        
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_nombre_social}" for="nombre_social" />
                        <h:outputText id="nombre_social" value="#{pacienteController.selected.nombre_social}" title="#{bundle.ViewpacienteTitle_nombre_social}"/>                        
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_region_residencia}" for="region_residencia" />
                        <h:outputText id="region_residencia" value="#{pacienteController.selected.region_residencia.nombre}" title="#{bundle.ViewpacienteTitle_region_residencia}"/>                                              
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_comuna_residencia}" for="comuna_residencia" />
                        <h:outputText id="comuna_residencia" value="#{pacienteController.selected.comuna_residencia.nombre}" title="#{bundle.ViewpacienteTitle_comuna_residencia}"/>                                                                    
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_calle_direccion}" for="calle_direccion" />
                        <h:outputText id="calle_direccion" value="#{pacienteController.selected.calle_direccion}" title="#{bundle.ViewpacienteTitle_calle_direccion}"/>                                              
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_fecha_nacimiento}" for="fecha_nacimiento" />
                        <h:outputText id="fecha_nacimiento" value="#{pacienteController.selected.fecha_nacimiento}">
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputText>                        
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_cesfam}" for="cesfam" />
                        <h:outputText id="cesfam" value="#{pacienteController.selected.cesfam.nombre}" title="#{bundle.ViewpacienteTitle_cesfam}"/>  
                        <p:outputLabel value="#{bundle.CreatepacienteTitle_telefono_fijo}" />
                        <p:column>
                            <b:row>
                                <b:column col-xs="8">
                                    <h:outputText  value="#{pacienteController.selected.telefono_fijo}"/>
                                </b:column>
                                <b:column col-xs="4">
                                    <h:outputText rendered="#{pacienteController.selected.domicilio}" value="Domicilio"/>
                                </b:column>
                            </b:row>
                        </p:column>
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_teléfono_movil}"/>
                        <p:column>
                            <b:row>
                                <b:column col-xs="8">
                                    <h:outputText value="#{pacienteController.selected.telefono_movil}" />
                                </b:column>
                                <b:column col-xs="4">
                                    <h:outputText rendered="#{pacienteController.selected.recados}" value="Recados"/>
                                </b:column>
                            </b:row>
                        </p:column>
                        <p:outputLabel value="Otro teléfono movil" />
                        <h:outputText value="#{pacienteController.selected.otro_telefono_movil}"  />
                        <p:outputLabel value="Teléfono colegio"  />
                        <h:outputText value="#{pacienteController.selected.telefono_colegio}"/>
                        <p:outputLabel value="Teléfono adulto responsable"  />
                        <h:outputText value="#{pacienteController.selected.telefono_responsable}" />
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_correo}" for="correo" />
                        <h:outputText id="correo" value="#{pacienteController.selected.correo}" title="#{bundle.ViewpacienteTitle_correo}"/>
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_sexo}" for="sexo1" />
                        <h:outputText id="sexo1" value="Hombre" title="#{bundle.ViewpacienteTitle_sexo}" rendered="#{pacienteController.selected.sexo == 1}"/>
                        <h:outputText id="sexo2" value="Mujer" title="#{bundle.ViewpacienteTitle_sexo}" rendered="#{pacienteController.selected.sexo == 2}"/>
                        <h:outputText id="sexo3" value="No Definido" title="#{bundle.ViewpacienteTitle_sexo}" rendered="#{pacienteController.selected.sexo == 3}"/>
                        <h:outputText id="sexo4" value="No Determinado" title="#{bundle.ViewpacienteTitle_sexo}" rendered="#{pacienteController.selected.sexo == 4}"/>
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_programa_social}" for="programa_social"  />
                        <h:outputText id="programa_social" value="#{pacienteController.selected.programa_social.nombre}" title="#{bundle.ViewpacienteTitle_programa_social}"/>

                        <p:outputLabel value="#{bundle.CreatepacienteLabel_prevision}" for="prevision" />
                        <h:outputText id="prevision" value="#{pacienteController.selected.prevision.nombre}" title="#{bundle.ViewpacienteTitle_prevision}"/>                     
                      
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_grupo_fonasa}" for="grupo_fonasa" rendered="#{pacienteController.selected.prevision.id == 1}"/>
                        <h:outputText id="grupo_fonasa" value="A" title="#{bundle.ViewpacienteTitle_grupo_fonasa}" rendered="#{pacienteController.selected.prevision.id == 1 and pacienteController.selected.grupo_fonasa == 1}"/>
                        <h:outputText id="grupo_fonasa2" value="B" title="#{bundle.ViewpacienteTitle_grupo_fonasa}" rendered="#{pacienteController.selected.prevision.id == 1 and pacienteController.selected.grupo_fonasa == 2}"/>
                        <h:outputText id="grupo_fonasa3" value="C" title="#{bundle.ViewpacienteTitle_grupo_fonasa}" rendered="#{pacienteController.selected.prevision.id == 1 and pacienteController.selected.grupo_fonasa == 3}"/>
                        <h:outputText id="grupo_fonasa4" value="D" title="#{bundle.ViewpacienteTitle_grupo_fonasa}" rendered="#{pacienteController.selected.prevision.id == 1 and pacienteController.selected.grupo_fonasa == 4}"/>
                        
                        <p:outputLabel value="País" for="nacionalidad" />
                        <h:outputText id="nacionalidad" value="#{pacienteController.selected.nacionalidad.nombre}" title="#{bundle.ViewpacienteTitle_nacionalidad}"/>                     
           
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_estado_conyugal}" for="estado_conyugal" />
                        <h:outputText id="estado_conyugal" value="#{pacienteController.selected.estado_conyugal.nombre}" title="#{bundle.ViewpacienteTitle_estado_conyugal}"/>                     
                        
                        <p:outputLabel value="#{bundle.CreatepacienteLabel_pueblo_originario}" for="pueblo_originario" />
                        <h:outputText id="pueblo_originario" value="#{pacienteController.selected.pueblo_originario.nombre}" title="#{bundle.ViewpacienteTitle_pueblo_originario}"/>                     
                        
                        <f:facet name="footer">
                            <p:commandButton id="editButton" icon="ui-icon-pencil" value="#{bundle.Edit}" actionListener="#{pacienteController.prepareUpdate()}" action="/paciente/Edit?faces-redirect=true" disabled="#{empty pacienteController.selected}" rendered="#{loginController.esFuncionario() || loginController.esEncargadoPrograma()}"/>
                        </f:facet>
                    </p:panelGrid>
                </h:panelGroup>
            </h:form>
        </b:panel>
            <b:panel id="pacienteClapViewDlg" title="CLAPS del Usuario" rendered="#{pacienteController.selected.id !=null}">
            <h:form id="clapViewForm">
                <h:panelGroup id="display">
                    
                <p:dataTable id="datalist" value="#{clapController.getItemsPorPaciente(pacienteController.selected.RUN)}" var="item"
                             selectionMode="single" selection="#{clapController.selected}"
                                 paginator="true"
                                 rowKey="#{item.id}"
                                 rows="10"
                                 rowsPerPageTemplate="10,20,30,40,50"
                                 emptyMessage="No hay elementos."
                                 >      
                        <p:ajax event="rowSelect"   update="viewButton editButton createClap viewRiesgosButton desactivateButton"/>
                        <p:ajax event="rowUnselect" update="viewButton editButton createClap viewRiesgosButton desactivateButton"/>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{bundle.ListclapTitle_fecha_consulta}"/>
                            </f:facet>
                            <h:outputText value="#{item.fecha_consulta}">
                                <f:convertDateTime pattern="MM/dd/yyyy" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{bundle.ListclapTitle_funcionario}"/>
                            </f:facet>
                            <h:outputText value="#{item.funcionario.nombres}"/>
                            #{" "}
                            <h:outputText value="#{item.funcionario.primer_apellido}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Riesgos"/>
                            </f:facet>
                            <h:outputText value="Riesgo salud sexual y reproductiva &lt;br /&gt;" rendered="#{item.riesgo_ssr}" escape="false"/>
                            <h:outputText value="Riesgo salud mental &lt;br /&gt;" rendered="#{item.riesgo_salud_mental}" escape="false"/>
                            <h:outputText value="Riesgo alcohol y drogas &lt;br /&gt;" rendered="#{item.riesgo_oh_drogas}" escape="false"/>
                            <h:outputText value="Riesgo nutricional &lt;br /&gt;" rendered="#{item.riesgo_nutricional}" escape="false"/>
                            <h:outputText value="Riesgo social &lt;br /&gt;" rendered="#{item.riesgo_social}" escape="false"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Edad paciente"/>
                            </f:facet>
                            <h:outputText value="#{clapController.calculoEdad(item.fecha_nacimiento)}">
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Estado"/>
                            </f:facet>
                            <h:outputText value="#{item.estado}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Secciones Incompletas"/>
                            </f:facet>
                            <h:outputText value="Usuario &lt;br /&gt;" rendered="#{!item.seccion_usuario}" escape="false"/>
                            <h:outputText value="Datos Generales &lt;br /&gt;" rendered="#{!item.seccion_datosgenerales}" escape="false"/>
                            <h:outputText value="Antecedentes Personales &lt;br /&gt;" rendered="#{!item.seccion_antecedentes_personales}" escape="false"/>
                            <h:outputText value="Antecedentes Familiares &lt;br /&gt;" rendered="#{!item.seccion_antecedentes_familiares}" escape="false"/>
                            <h:outputText value="Familia &lt;br /&gt;" rendered="#{!item.seccion_familia}" escape="false"/>
                            <h:outputText value="Vivienda &lt;br /&gt;" rendered="#{!item.seccion_vivienda}" escape="false"/>
                            <h:outputText value="Educación &lt;br /&gt;" rendered="#{!item.seccion_educacion}" escape="false"/>
                            <h:outputText value="Trabajo &lt;br /&gt;" rendered="#{!item.seccion_trabajo}" escape="false"/>
                            <h:outputText value="Vida Social &lt;br /&gt;" rendered="#{!item.seccion_vida_social}" escape="false"/>
                            <h:outputText value="Hábitos/consumo &lt;br /&gt;" rendered="#{!item.seccion_habitos}" escape="false"/>
                            <h:outputText value="Gineco/urológico &lt;br /&gt;" rendered="#{!item.seccion_gineco}" escape="false"/>
                            <h:outputText value="Sexualidad &lt;br /&gt;" rendered="#{!item.seccion_sexualidad}" escape="false"/>
                            <h:outputText value="Situación Psicoemocional &lt;br /&gt;" rendered="#{!item.seccion_psicoemocional}" escape="false"/>
                            <h:outputText value="Examen Físico &lt;br /&gt;" rendered="#{!item.seccion_examen_fisico}" escape="false"/>
                        </p:column>
                        <f:facet name="footer">
                            <p:commandButton id="createClap" icon="ui-icon-plus"   value="Crear Clap" rendered="#{loginController.esFuncionario() or loginController.esEncargadoPrograma()}" onclick="PF('cd2').show()" disabled="#{clapController.limiteVigente()}"/>
                            <p:commandButton id="viewButton" icon="ui-icon-search" value="#{bundle.View}" disabled="#{empty clapController.selected || clapController.selected.id == null}" action="#{clapController.prepareView()}" oncomplete="/clap/View"/>
                            <p:commandButton id="editButton"   icon="ui-icon-pencil" value="#{bundle.Edit}" actionListener="#{clapController.prepareEdit}" action="/clap/edit/usuario?faces-redirect=true" disabled="#{empty clapController.selected ||  not clapController.esIncompleto() || clapController.selected.id == null}" rendered="#{loginController.esFuncionario() or loginController.esEncargadoPrograma()}"/>
                            <p:commandButton id="desactivateButton" icon="ui-icon-cancel"  value="Anular" actionListener="#{clapController.anular}" update=":growl,datalist"  disabled="#{clapController.esAnulado() || empty clapController.selected || clapController.selected.id == null}" rendered="#{loginController.esFuncionario() or loginController.esEncargadoPrograma()}">
                                <p:confirm header="Confirme Anulación" message="Esta segur@ de anular la ficha CLAP?" icon="ui-icon-alert" />
                            </p:commandButton>
                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                            </p:confirmDialog>
                            <p:commandButton id="viewRiesgosButton"   icon="ui-icon-search" value="Ver Riesgos" actionListener="#{clapController.prepareRiesgos}" action="/clap/Riesgos?faces-redirect=true" disabled="#{empty clapController.selected || clapController.esIncompleto() || clapController.esAnulado()}"/>                      
                            <p:commandButton actionListener="#{clapController.createPDF}" icon="ui-icon-arrowthickstop-1-s" value="Crear PDF" ajax="false" update="display,:clapViewForm:datalist,:growl" disabled="#{empty clapController.selected || clapController.selected.id == null}"/>
                            <p:confirmDialog message="Esta de segur@ de crear una ficha CLAP ?" header="Crear Ficha CLAP" severity="alert" widgetVar="cd2">
                                <p:commandButton value="Si" action="#{clapController.create()}" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" oncomplete="/clap/View"/>
                                <p:commandButton value="No" type="button" onclick="PF('cd2').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                            </p:confirmDialog>
                        </f:facet>
                </p:dataTable>
                </h:panelGroup>
            </h:form>
        </b:panel>
            <br/>
            <b:panel id="pacienteActividadViewDlg" title="Actividades de Intervención del Usuario" rendered="#{pacienteController.selected.id !=null}">
            <h:form id="actividadListForm">
                <h:panelGroup id="display2">                   
                    <p:dataTable id="datalist" value="#{actividadController.getItemsPorPaciente(pacienteController.selected)}" var="item2"
                                 selectionMode="single" selection="#{actividadController.selected}"
                                 paginator="true"
                                 rowKey="#{item2.id}"
                                 rows="10"
                                 rowsPerPageTemplate="10,20,30,40,50"
                                 emptyMessage="No hay elementos."
                                 >      
                        <p:ajax event="rowSelect"   update="viewButton editButton"/>
                        <p:ajax event="rowUnselect" update="viewButton editButton"/>

                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{bundle.ListactividadTitle_fecha_realizacion}"/>
                            </f:facet>
                            <h:outputText value="#{item2.fecha_realizacion}">
                                <f:convertDateTime pattern="dd/MM/yyyy" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Funcionario PSA a cargo"/>
                            </f:facet>
                            <h:outputText value="#{item2.usuario.RUT}">
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Actividades realizadas"/>
                            </f:facet>
                            <h:outputText rendered="#{item2.consejeria_actividad_fisica}" value="Consejeria en Actividad Fisica  &lt;br /&gt;" escape="false" />
                            <h:outputText rendered="#{item2.consejeria_alimentacion_saludable}" value="Consejería en alimentación saludable  &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_consumo_drogas}" value="Consejería en consumo de Drogas  &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_familiares}" value="Consejerias familiares &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_motivacional}" value="Entrevista Motivacional &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_regulacion_fecundidad}" value="Consejería en Regulación de Fecundidad &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_salud_mental}" value="Consejería Salud Mental &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_ssr}" value="Consejeria en Salud Sexual y Reproductiva &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_tabaquismo}" value="Consejería en Tabaquismo &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.consejeria_vih_its}" value="Consejería en Prevención de VIH e ITS &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.ingreso_control_prenatal}" value="Ingreso a Control Prenatal &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.ingreso_programa_cardiovascular}" value="Ingreso a Programa Cariovascular &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.ingreso_programa_intervencion}" value="Ingreso a Programas de Intervencion &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.ingreso_regulacion_fecundidad}" value="Ingreso a Regulacion de Fecundidad &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.ingreso_salud_mental}" value="Ingreso a salud Mental &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.nivelacion_estudios}" value="Nivelación  de estudios &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.vinculacion_beneficios_sociales}" value="Vinculacion de beneficios sociales &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.intervencion_breve_alcohol}" value="Intervención breve en alcohol &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.derivacion_colegio}" value="Derivación a colegio &lt;br /&gt;" escape="false"/>
                            <h:outputText rendered="#{item2.derivacion_otra_comuna}" value="Derivación a otra comuna &lt;br /&gt;" escape="false"/>
                        </p:column>
                        <f:facet name="footer">
                            <p:commandButton id="viewButton"   icon="ui-icon-search" value="#{bundle.View}" update=":actividadViewForm" oncomplete="PF('actividadViewDialog').show()" disabled="#{empty actividadController.selected}"/>
                            <p:commandButton id="editButton"   icon="ui-icon-pencil" value="#{bundle.Edit}" actionListener="#{actividadController.prepareUpdate()}" update=":actividadEditForm" oncomplete="PF('actividadEditDialog').show()" disabled="#{empty actividadController.selected}" rendered="#{loginController.esFuncionario() || loginController.esEncargadoPrograma()}"/>
                        </f:facet>
                </p:dataTable>
                </h:panelGroup>
            </h:form>
                <ui:include src="/actividad/Edit.xhtml"/>
                <ui:include src="/actividad/View.xhtml"/>
        </b:panel>
        <h:form rendered="#{pacienteController.selected.id == null}">
            <h2 align="center ">No existe registro del RUN. Realize una búsqueda, ingrese los datos, y presione el botón guardar</h2>
        </h:form>
        </ui:define>
    </ui:composition>
</html>
